---
apiVersion: v1
kind: Secret
metadata:
  name: unifi-restic-config
  namespace: unifi
type: Opaque
stringData:
  RESTIC_REPOSITORY: ${RESTIC_REPOSITORY_BASE}:/unifi
  RESTIC_PASSWORD: ${RESTIC_PASSWORD}
  GOOGLE_PROJECT_ID: ${RESTIC_GOOGLE_PROJECT_ID}
  GOOGLE_APPLICATION_CREDENTIALS: |
    ${RESTIC_GOOGLE_APPLICATION_CREDENTIALS}
---
apiVersion: volsync.backube/v1alpha1
kind: ReplicationSource
metadata:
  name: unifi-backup
  namespace: unifi
spec:
  sourcePVC: unifi-shelf
  trigger:
    # Take a backup daily
    schedule: "0 0 * * *"
  restic:
    pruneIntervalDays: 14
    repository: unifi-restic-config
    retain:
      daily: 5
      weekly: 4
      monthly: 2
      yearly: 1
    copyMethod: Snapshot
    volumeSnapshotClassName: csi-rbdplugin-snapclass
