---
apiVersion: infra.contrib.fluxcd.io/v1alpha1
kind: Terraform
metadata:
  name: homelab
  namespace: tf-controller
spec:
  interval: 1m
  approvePlan: disable
  path: ./hosts/dev/
  sourceRef:
    kind: GitRepository
    name: homelab
    namespace: flux-system
  backendConfig:
    customConfiguration: |
      backend "gcs" {
        bucket = "woodgreen-tfstate-dev"
        prefix = "terraform/state"
      }
  runnerPodTemplate:
    spec:
      env:
      - name: GOOGLE_APPLICATION_CREDENTIALS
        value: /config/gcloud-service-account.json
      volumes:
      - name: tf-gcloud-secret
        secret:
          secretName: tf-gcloud-secret
      volumeMounts:
      - name: tf-gcloud-secret
        mountPath: /config/
        readOnly: true
