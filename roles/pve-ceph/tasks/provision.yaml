---
- name: Verify ceph directories
  file:
    path: /var/lib/ceph/{{ item }}
    state: directory
  with_items:
  - mon
  - mgr
  notify: create ceph config

- name: Populate service facts
  service_facts:

- name: Verify ceph mon
  debug:
  changed_when: "ceph_mon_service not in ansible_facts.services"
  notify: create ceph mon

- name: Verify ceph mgr
  debug:
    msg: Verify ceph services
  changed_when: "ceph_mgr_service not in ansible_facts.services"
  notify: create ceph mgr

- name: Verify ceph osd
  debug:
    msg: Verify ceph services
  changed_when: "ceph_osd_service not in ansible_facts.services"
  notify: create ceph osd

- name: Verify ceph mds
  debug:
    msg: Verify ceph services
  changed_when: "ceph_mds_service not in ansible_facts.services"
  notify: create ceph mds

- name: Flush handlers
  meta: flush_handlers

# See https://docs.ceph.com/en/latest/mgr/prometheus/
- name: Create prometheus server
  command: ceph mgr module enable prometheus
  ignore_errors: yes