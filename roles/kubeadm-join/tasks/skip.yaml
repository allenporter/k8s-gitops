---
- name: Verify node has not joined yet
  command: "kubectl get nodes {{ ansible_hostname }} --kubeconfig={{ kube_config }}"
  register: get_nodes
  delegate_to: localhost
  failed_when: "' Ready ' in get_nodes.stdout"
  changed_when: "'NotFound' in get_nodes.stdout"
  ignore_errors: true
  when: root_node is not defined or root_node != "true"

- name: Skip if already upgraded
  meta: end_host
  when: (root_node is not defined or root_node != 'true') and (get_nodes.rc == 0)