---
- name: Allow kubeadm package updates
  dpkg_selections:
    name: "{{ item }}"
    selection: install
  with_items:
  - kubectl
  - kubelet

- name: "Update kubernetes packages to {{ k8s_version }}"
  apt:
    name:
    - "kubectl={{ k8s_pkg_version }}"
    - "kubelet={{ k8s_pkg_version }}"
    state: present
    # Uncomment for downgrade
    # force: true
    update_cache: yes
    force_apt_get: yes
    cache_valid_time: 86400  # one day
  notify: restart kubelet

- name: Flush handlers
  meta: flush_handlers

- name: Pause
  ansible.builtin.pause:
    seconds: 10