---
- name: Verify kubeadm installed version
  command: kubeadm version -o short
  register: kubeadm_version 
  failed_when: "('v' + k8s_version) != kubeadm_version.stdout"

# For the root control plane node
- name: "Upgrade first node in the cluster to {{ k8s_version }}"
  command: "kubeadm upgrade apply {{ k8s_version }} --yes"
  when: root_node is defined and root_node == "true"
  register: upgrade_root

- debug:
    var: upgrade_root.stdout_lines
  when: root_node is defined and root_node == "true"  

# For other control plane nodes or worker nodes
- name: "Upgrade node to {{ k8s_version }}"
  command: "kubeadm upgrade node"
  when: root_node is not defined or root_node == "false"
  register: upgrade_node

- debug:
    var: upgrade_node.stdout_lines
  when: root_node is not defined or root_node == "false"