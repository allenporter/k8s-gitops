---
- name: Check if configuration exists
  stat:
    path: "{{ env_dir }}/ceph.keyring"
  delegate_to: localhost
  run_once: yes
  register: st

- name: Generate ceph keyring
  shell: ceph auth get-or-create client.admin
  register: ceph_keyring
  run_once: yes
  when: st.stat.exists == False

- name: Write ceph config to local environment
  copy:
    content: "{{ ceph_keyring.stdout }}\n"
    dest: "{{ env_dir }}/ceph.keyring"
  delegate_to: localhost
  run_once: yes
  when: st.stat.exists == False
