---
- name: Allow kubeadm package updates
  dpkg_selections:
    name: "{{ item }}"
    selection: install
  with_items:
    - kubeadm

- name: Update package sources
  apt:
    update_cache: yes

- name: "Update kubeadm to {{ k8s_version }}"
  apt:
    name: "kubeadm={{ k8s_pkg_version }}"
    state: present
    # Uncomment for downgrade
    # force: true
    update_cache: yes
    force_apt_get: yes
    cache_valid_time: 86400  # one day