---
- name: Grab the swap space used (in megabytes)
  shell: free -m | grep Swap | awk '{print $2}'
  register: swap_used

- name: Remove swapfile from /etc/fstab
  mount:
    name: swap
    fstype: swap
    state: absent
  when: (swap_used.stdout_lines[0] | int) > 0

- name: disable swap
  command: swapoff -a
  when: (swap_used.stdout_lines[0] | int) > 0
