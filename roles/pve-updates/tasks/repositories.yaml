---
# Sources https://pve.proxmox.com/wiki/Package_Repositories
- name: Prepare debian repositories
  apt_repository:
    repo: "{{ item.repo }}"
    state: "{{ item.state }}"
  with_items:
    - repo: deb http://ftp.us.debian.org/debian bookworm main contrib
      state: present
    - repo: deb http://ftp.us.debian.org/debian bookworm-updates main contrib
      state: present
    - repo: deb http://security.debian.org bookworm-security main contrib
      state: present
    - repo: deb http://ftp.us.debian.org/debian bullseye main contrib
      state: absent
    - repo: deb http://ftp.us.debian.org/debian bullseye-updates main contrib
      state: absent
    - repo: deb http://security.debian.org bullseye-security main contrib
      state: absent

- name: Prepare proxmox repositories
  apt_repository:
    repo: "{{ item.repo }}"
    state: "{{ item.state }}"
  with_items:
    - repo: deb http://download.proxmox.com/debian/pve bookworm pve-no-subscription
      state: present
    - repo: deb https://enterprise.proxmox.com/debian/pve bookworm pve-enterprise
      state: absent
    - repo: deb https://enterprise.proxmox.com/debian/pve bullseye pve-enterprise
      state: absent
    - repo: deb http://download.proxmox.com/debian/pve bullseye pve-no-subscription
      state: absent


- name: Prepare ceph repositories
  apt_repository:
    repo: "{{ item.repo }}"
    state: "{{ item.state }}"
  with_items:
    - repo: "deb http://download.proxmox.com/debian/ceph-{{ ceph_version }} bookworm no-subscription"
      state: present
    - repo: "deb http://download.proxmox.com/debian/ceph-quincy bullseye main"
      state: absent
    - repo: "deb http://download.proxmox.com/debian/ceph-pacific bullseye main"
      state: absent
    - repo: "deb http://download.proxmox.com/debian/ceph-octopus bullseye main"
      state: absent
  when: ceph_version is defined