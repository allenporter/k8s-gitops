# Tear down kubernetes
---
- hosts: kapi,kube
  become: yes
  become_user: root
  tasks:
  - name: Stop kubelet
    service:
      name: kubelet
      daemon_reload: yes
      state: stopped

  - name: Stop docker
    service:
      name: docker
      state: stopped

  - name: Reset kubernetes
    shell:
      cmd: "kubeadm reset --force"

  - name: Remove files
    shell:
      cmd: "rm -fr /etc/cni/net.d"

  - name: Wipe etcd state
    become: false
    shell:
      cmd: "etcdctl del '/registry' --prefix"
    delegate_to: localhost
    run_once: yes
