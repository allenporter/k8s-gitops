---

- hosts: vmm
  gather_facts: yes
  become: yes
  become_user: root
  tasks:
  - name: Teardown ceph
    pause:
      prompt: Please confirm you with to permanently destory ceph, ^C to cancel

  - name: Destroy metadata server
    command: pveceph mds destroy {{ vmm_node }}
    ignore_errors: yes

  - name: Destory ceph pool
    command: pveceph pool destroy "kube-pool"
    ignore_errors: yes

  - name: Destory ceph manager
    command: pveceph mgr destroy {{ vmm_node }}
    ignore_errors: yes

  - name: Destroy ceph monitors
    command: pveceph mon destroy {{ vmm_node }}
    ignore_errors: yes

  - name: Stop ceph
    command: pveceph stop

  - name: Purge ceph
    command: pveceph purge -crash -logs
    ignore_errors: yes

  - name: Remove ceph mgr dir
    command: rm -fr /var/lib/ceph/*

  - name: Remove ceph config
    command: rm /etc/pve/ceph.conf

  - name: Restart pvestatd
    command: systemctl restart pvestatd