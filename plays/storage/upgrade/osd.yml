---
- hosts: vmm
  gather_facts: yes
  become: yes
  become_user: root
  vars_prompt:
    - name: restart_osd_prompt
      prompt: "About to restart OSDs. Press return to continue, or ctrl-c to abort"
      private: no

- hosts: vmm
  become: yes
  become_user: root
  serial: 1
  tasks:
  - name: Restart ceph OSDs
    ansible.builtin.systemd:
      state: restarted
      name: "{{ ceph_osd_service }}"

  - name: View ceph upgrade status
    command: ceph status
    register: osd_restart

  - debug:
      var: osd_restart.stdout_lines

  - name: Pause after each OSD restart
    pause:
      prompt: "Make sure OSD is healthy"

- hosts: vmm
  become: yes
  become_user: root
  serial: 1
  tasks:
  - name: Locking minimum version
    command: "ceph osd require-osd-release {{ ceph_version }}"
    run_once: true
