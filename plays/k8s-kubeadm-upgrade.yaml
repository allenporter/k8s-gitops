#!/usr/bin/env ansible-playbook
# Based on:
# https://kubernetes.io/docs/tasks/administer-cluster/kubeadm/kubeadm-upgrade/
#
# See k8s_version in vars.yaml
---
- hosts: kapi,kube
  become: yes
  serial: 1
  vars_files:
  - vars.yaml
  roles:
  - k8s-repository
  - kubeadm-update
  - kubeadm-upgrade-skip
  - role: kubeadm-upgrade-plan
    when: root_node is defined and root_node == "true"
  - kubeadm-upgrade
  - kubeadm-update-hold

# Verify all nodes have packages held even if skipped
- hosts: kapi,kube
  become: yes
  roles:
  - kubeadm-update-hold
