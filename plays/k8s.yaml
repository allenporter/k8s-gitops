#!/usr/bin/env ansible-playbook
---
- hosts: kapi,kube
  become: yes
  vars_files:
  - vars.yaml
  roles:
  - kubeadm-update-hold
  - k8s-repository
  - kubelet
  # This only runs for nodes that already exist, and is run at end of join
  # commands. Comment out when provisioning new nodes
  - kubelet-node
  - role: kubelet-gpu
    when: nvidia_gpu is defined and nvidia_gpu == "true"

- hosts: prx,kube,kapi
  become: yes
  roles:
  - updates
  - common
  - packetloss

- hosts: prx
  become: yes
  roles:
  - haproxy
