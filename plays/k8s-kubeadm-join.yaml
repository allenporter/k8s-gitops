#!/usr/bin/env ansible-playbook
# Based on:
# https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/
#
# See k8s_version in vars.yaml
---
- hosts: kube
  become: yes
  serial: 1
  vars_files:
  - vars.yaml
  roles:
  - k8s-repository
  - kubeadm-update
  - kubelet

# Verify all nodes have packages held even if skipped
- hosts: kapi,kube
  become: yes
  roles:
  - kubeadm-update-hold

- hosts: kapi,kube
  become: yes
  vars_files:
  - vars.yaml
  roles:
  - kubeadm-join

- hosts: kapi,kube
  become: yes
  vars_files:
  - vars.yaml
  roles:
  - kubelet-node
