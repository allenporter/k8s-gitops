---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: home-assistant
  namespace: home-assistant
spec:
  chart:
    spec:
      # renovate: registryUrl=https://k8s-at-home.com/charts/
      chart: home-assistant
      version: 11.2.1
  values:
    image:
      repository: homeassistant/home-assistant
      tag: dev@sha256:395665883fc03e4b625edc85b57e018bd73f0f1983969f08ddd225d0906e9428
    ingress:
      main:
        annotations:
          external-dns.alpha.kubernetes.io/hostname: home-assistant.dev.mrv.thebends.org.
          external-dns.alpha.kubernetes.io/target: prx03.dev.mrv.thebends.org.
        hosts:
          - host: home-assistant.dev.mrv.thebends.org
            paths:
              - path: /
        tls:
          - secretName: home-assistant-tls
            hosts:
              - home-assistant.dev.mrv.thebends.org

    env:
      HASS_INTERNAL_URL: "https://home-assistant.dev.mrv.thebends.org"
      HASS_EXTERNAL_URL: "https://home-assistant.dev.mrv.thebends.org:28123"

    addons:
      codeserver:
        ingress:
          annotations:
            external-dns.alpha.kubernetes.io/hostname: vscode-ha.dev.mrv.thebends.org.
            external-dns.alpha.kubernetes.io/target: prx02.dev.mrv.thebends.org
          hosts:
            - host: vscode-ha.dev.mrv.thebends.org
              paths:
                - path: /
          tls:
            - secretName: vscode-home-assistant-tls
              hosts:
                - vscode-ha.dev.mrv.thebends.org

    mariadb:
      enabled: true
      auth:
        database: home-assistant
        username: home-assistant
        password: ${HOME_ASSISTANT_MARIADB_USER_PWD}
        rootPassword: ${HOME_ASSISTANT_MARIADB_ROOT_PWD}
      primary:
        persistence:
          enabled: true
