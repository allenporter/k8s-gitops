---
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-datasource
  namespace: teslamate
  labels:
    grafana_datasource: "1"
data:
  ha-datasource.yaml: |-
    apiVersion: 1
    datasources:
    - name: TeslaMate
      type: postgres
      url: teslamate-postgresql.teslamate:5432
      database: teslamate
      # Create account w/ readonly access:
      # $ kubectl exec -it teslamate-postgresql-0 -n teslamate -- bash
      # $ psql -U postgres -h localhost -p 5432
      # # CREATE USER teslamate WITH PASSWORD 'teslamate';
      # and verify with \du+
      user: teslamate
      secureJsonData:
        password: ${TESLAMATE_READONLY_POSTGRES_PWD}
      access: proxy
      postgresVersion: 11
      jsonData:
        sslmode: disable
        timeInterval: 30s
